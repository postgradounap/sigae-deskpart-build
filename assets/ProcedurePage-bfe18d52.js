import{r as ue,c as R,d as q,b as u,e as C,g as r,p as y,t as x,h as t,F,a as U,u as M,G as _e,i as w,w as n,f as l,H as j,I as S,J as Y,K as ye,L as xe,M as he,k as O,m as T,o as Q,j as Z,s as W,v as se,x as H,y as ae,N as re,O as le,P as we,Q as Ve,B as pe,R as $e,S as ke,T as Ce,U as Te,V as De,W as Pe,C as Le,D as Me,_ as me,A as Ue,X as J,Y as Ee,n as Re,Z as Ae,$ as Fe}from"./index-09f75e69.js";/* empty css                     *//* empty css                 *//* empty css                     */var N=(o=>(o.started="started",o.in_progress="in_progress",o.finished="finished",o))(N||{});const f=ue({procedureList:[],isModalOpen:!1,isModalDetails:!1,isModalDerivation:!1,isModalFinish:!1,personList:[],currentProcedure:null,procedureTypeList:[],headquarterList:[],procedureTracingList:[],procedureCounter:{started:{total:0,count:0,label:""},in_progress:{total:0,count:0,label:""},finished:{total:0,count:0,label:""}},yearsProcedures:[],tabSelected:N.started,isOpenTimeline:!1,areaList:[],userAreaList:[],filters:{date:"",code_number:"",state:N.started},procedureRequirements:[]}),Se={procedureList:{get:()=>f.procedureList,set:o=>f.procedureList=o},isModalOpen:{get:()=>f.isModalOpen,set:o=>f.isModalOpen=o},isModalDetails:{get:()=>f.isModalDetails,set:o=>f.isModalDetails=o},isModalDerivation:{get:()=>f.isModalDerivation,set:o=>f.isModalDerivation=o},isModalFinish:{get:()=>f.isModalFinish,set:o=>f.isModalFinish=o},personList:{get:()=>f.personList,set:o=>f.personList=o,add:o=>f.personList.push(o)},currentProcedure:{get:()=>f.currentProcedure,set:o=>f.currentProcedure=o},procedureTypeList:{get:()=>f.procedureTypeList,set:o=>f.procedureTypeList=o},headquarterList:{get:()=>f.headquarterList,set:o=>f.headquarterList=o},procedureTracingList:{get:()=>f.procedureTracingList,set:o=>f.procedureTracingList=o},procedureCounter:{get:()=>f.procedureCounter,set:o=>f.procedureCounter=o},yearsProcedures:{get:()=>f.yearsProcedures,set:o=>f.yearsProcedures=o},tabSelected:{get:()=>f.tabSelected,set:o=>f.tabSelected=o},isOpenTimeline:{get:()=>f.isOpenTimeline,set:o=>f.isOpenTimeline=o},areaList:{get:()=>f.areaList,set:o=>f.areaList=o},userAreaList:{get:()=>f.userAreaList,set:o=>f.userAreaList=o,clear:()=>f.userAreaList=[]},filters:{get:()=>f.filters,set:o=>{f.filters=o}},procedureRequirements:{get:()=>f.procedureRequirements,set:o=>f.procedureRequirements=o}},c=R(()=>Se).value,qe={class:"w-full text-sm p-2 flex flex-col items-center justify-center"},Ne=r("i",{class:"fas fa-file-alt text-3xl"},null,-1),je={class:"text-xs"},Oe=r("b",null,"Tramite",-1),Ie=r("div",{class:"w-full h-px bg-gray-300"},null,-1),ze={class:"p-2 flex flex-col gap-2"},Ye=r("div",{class:"text-base text-blue-400 font-light"},"Datos del Tramite",-1),Be={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},Ge=r("i",{class:"fas fa-user"},null,-1),Ze={class:"font-semibold"},He={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},Ke=r("i",{class:"fas fa-calendar"},null,-1),Je={class:"font-semibold"},Qe={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},We=r("i",{class:"fas fa-map-marker-alt"},null,-1),Xe={class:"font-semibold"},et={key:0,class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},tt=r("i",{class:"fa-sharp fa-solid fa-check"},null,-1),ot=r("span",{class:"font-semibold bg-yellow-400 text-white rounded-lg px-2"},"Por confirmar aprobación",-1),st=r("div",{class:"w-full border border-dotted"},null,-1),at=r("div",{class:"text-base text-blue-400 font-light"},"Datos del Tramitante",-1),rt={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},lt=r("i",{class:"fas fa-user"},null,-1),nt={class:"font-semibold"},ct={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},dt=r("i",{class:"fas fa-file"},null,-1),it={class:"font-semibold"},ut={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},_t=r("i",{class:"fas fa-file"},null,-1),pt={class:"font-semibold"},mt={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},ft=r("i",{class:"fas fa-file"},null,-1),gt={class:"font-semibold"},bt=q({__name:"leftCard",setup(o){const e=R(()=>c.currentProcedure.get());return(a,s)=>{var d;return u(),C("div",null,[r("div",qe,[Ne,r("div",je,[Oe,y(": "),r("span",null,x((d=t(e))==null?void 0:d.code_number),1)])]),Ie,r("div",ze,[Ye,r("div",Be,[Ge,y("Creado por: "),r("span",Ze,x(t(e).user_name),1)]),r("div",He,[Ke,y("Fecha: "),r("span",Je,x(t(e).created_at),1)]),r("div",Qe,[We,y("Lugar de creación: "),r("span",Xe,x(t(e).headquarter_name),1)]),t(e).state?(u(),C("div",et,[tt,y("Estado: "),ot])):F("",!0),st,at,r("div",rt,[lt,y("Tramitante: "),r("span",nt,x(t(e).person_full_name),1)]),r("div",ct,[dt,y("Nro. Documento: "),r("span",it,x(t(e).person_document),1)]),r("div",ut,[_t,y("Asunto: "),r("span",pt,x(t(e).procedure_type_description),1)]),r("div",mt,[ft,y("Nro. Referencia: "),r("span",gt,x(t(e).reference_doc_number),1)])])])}}}),vt=async o=>{var e;try{const a=(e=U.routes.get().desk.procedures)==null?void 0:e.get_procedure_and_tracing_by_id;if(!a)return;const{data:s}=await M.post(a,{procedure_id:o});c.currentProcedure.set(s.procedure),c.procedureTracingList.set(s.procedure_tracings)}catch(a){console.log(a)}},yt={class:"flex justify-start gap-2 h-full"},xt={class:"items-center rounded-lg shadow-md w-[60%] h-96 p-2 timelineContent"},ht={class:"p-2 shadow rounded text-xs font-[roboto] border flex flex-col gap-2"},wt={class:"break-normal"},Vt={class:"text-[10px]"},$t=q({__name:"procedureTimeline",setup(o){const e=R({get:()=>c.isOpenTimeline.get(),set:s=>c.isOpenTimeline.set(s)});_e(()=>e.value,s=>{s&&vt(c.currentProcedure.get().id)});const a=R(()=>c.procedureTracingList.get());return(s,d)=>{const m=bt,v=he,V=ye,g=xe;return u(),w(g,{modelValue:t(e),"onUpdate:modelValue":d[0]||(d[0]=i=>Y(e)?e.value=i:null),"align-center":!0,class:"customDialog"},{default:n(()=>[r("div",yt,[l(m,{class:"w-[40%] flex flex-col gap-2"}),r("div",xt,[l(V,null,{default:n(()=>[(u(!0),C(S,null,j(t(a),i=>(u(),w(v,{key:i.id,timestamp:i.date+" "+i.hour,placement:"top",color:"green"},{default:n(()=>[r("div",ht,[r("span",wt,x(i.action_log),1),r("b",Vt,"Por: "+x(i.user),1)])]),_:2},1032,["timestamp"]))),128))]),_:1})])])]),_:1},8,["modelValue"])}}});const fe=async()=>{try{const{get_areas:o}=U.routes.get().desk,{data:e,status:a}=await M.get(o);a==200&&c.areaList.set(e)}catch(o){console.log(o)}},kt=()=>c.filters.get(),X=async()=>{var o;try{const e=(o=U.routes.get().desk.procedures)==null?void 0:o.get_procedures;if(!e)return;const{data:a}=await M.get(e,{params:kt()});c.procedureList.set(a.procedures),c.procedureCounter.set(a.counters)}catch(e){console.log(e)}},Ct=async o=>{try{const e=U.routes.get().desk.finally_trace_procedure,{status:a}=await M.post(e,o);a==200&&(O.success("Se Finalizo el Tramite correctamente"),X())}catch(e){console.log(e)}},Tt=q({__name:"procedureFinish",setup(o){const e=T(!1),a=R(()=>c.currentProcedure.get()),s=T({action:"",assigned_user_id:0});Q(async()=>{await fe()});const d=()=>{c.isModalFinish.set(!1)},m=async()=>{var v;e.value=!0,a.value&&(s.value.procedure_id=a.value.id,Z.user.get()&&(s.value.user_id=(v=Z.user.get())==null?void 0:v.id)),e.value=!1,await Ct(s.value),d()};return(v,V)=>{const g=W,i=se,_=H,b=ae;return u(),w(b,{"label-position":"top",model:t(s)},{default:n(()=>[l(i,{label:"Acción"},{default:n(()=>[l(g,{type:"textarea",autosize:{minRows:4,maxRows:6},modelValue:t(s).action,"onUpdate:modelValue":V[0]||(V[0]=E=>t(s).action=E)},null,8,["modelValue"])]),_:1}),l(i,{class:"flex mt-10 items-end"},{default:n(()=>[l(_,{loading:t(e),type:"primary",onClick:m},{default:n(()=>[y(x(t(a)?"Guardar":""),1)]),_:1},8,["loading"]),l(_,{onClick:d},{default:n(()=>[y("Cancel")]),_:1})]),_:1})]),_:1},8,["model"])}}});const Dt=async o=>{try{const{get_user_for_area:e}=U.routes.get().desk,{data:a,status:s}=await M.post(e,{area_id:o});s==200&&c.userAreaList.set(a)}catch(e){console.log(e)}},ee=ue({tracingsForArea:[],tracingsForUser:[]}),oe={get tracingsForArea(){return ee.tracingsForArea},set tracingsForArea(o){ee.tracingsForArea=o},get tracingsForUser(){return ee.tracingsForUser},set tracingsForUser(o){ee.tracingsForUser=o}},de=async()=>{var o,e;try{const a=(o=U.routes.get().desk.procedure_tracing)==null?void 0:o.get_tracings_to_approved;if(!a){console.log("No se encontró la ruta para obtener los trámites pendientes");return}const s=((e=Z.user.get())==null?void 0:e.id)||0,{data:d}=await M.post(a,{user_id:s});oe.tracingsForArea=d.tracings_for_area,oe.tracingsForUser=d.tracings_for_user}catch(a){console.log(a)}},Pt=async o=>{try{const e=U.routes.get().desk.save_derive_procedure,{status:a,data:s}=await M.post(e,o);return a==200?(O.success("Se derivo el Tramite correctamente"),X(),de(),!0):(O.error(`${s.message}`),!1)}catch(e){return console.log(e),!1}},Lt=q({__name:"procedureDerivation",setup(o){const e=T(!1),a=R(()=>c.currentProcedure.get()),s=T({action:"",assigned_user_id:0});Q(async()=>{await fe()});const d=V=>{s.value.assigned_user_id=0,c.userAreaList.clear(),Dt(V)},m=()=>{c.isModalDerivation.set(!1)},v=async()=>{var V;e.value=!0,a.value&&(s.value.procedure_id=a.value.id,Z.user.get()&&(s.value.user_id=(V=Z.user.get())==null?void 0:V.id)),e.value=!1,await Pt(s.value),m()};return(V,g)=>{const i=re,_=le,b=se,E=W,A=H,P=ae;return u(),w(P,{"label-position":"top",model:t(s)},{default:n(()=>[l(b,{label:"Oficina"},{default:n(()=>[l(_,{class:"w-full",placeholder:"Seleccione una oficina",modelValue:t(s).to_area_id,"onUpdate:modelValue":g[0]||(g[0]=p=>t(s).to_area_id=p),onChange:g[1]||(g[1]=p=>d(t(s).to_area_id))},{default:n(()=>[(u(!0),C(S,null,j(t(c).areaList.get(),p=>(u(),w(i,{key:p.id,label:p.nombre,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{label:"Acción"},{default:n(()=>[l(E,{type:"textarea",autosize:{minRows:4,maxRows:6},modelValue:t(s).action,"onUpdate:modelValue":g[2]||(g[2]=p=>t(s).action=p)},null,8,["modelValue"])]),_:1}),l(b,{label:"Asignar Usuario"},{default:n(()=>[l(_,{class:"w-full",placeholder:"Seleccione Usuario",modelValue:t(s).assigned_user_id,"onUpdate:modelValue":g[3]||(g[3]=p=>t(s).assigned_user_id=p)},{default:n(()=>[(u(!0),C(S,null,j(t(c).userAreaList.get(),p=>(u(),w(i,{key:p.id,label:p.full_name,value:p.user_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(b,{class:"flex mt-10 items-end"},{default:n(()=>[l(A,{loading:t(e),type:"primary",onClick:v},{default:n(()=>[y(x(t(a)?"Derivar":""),1)]),_:1},8,["loading"]),l(A,{onClick:m},{default:n(()=>[y("Cancel")]),_:1})]),_:1})]),_:1},8,["model"])}}});const ie={dni:"https://api.perudevs.com/api/v1/dni/simple?document=DOCUMENT_NUMBER&key=cGVydWRldnMucHJvZHVjdGlvbi5maXRjb2RlcnMuNjQ1Mjg1ZDA1MzAyNzA0ZDZmMmE1Njg2",ruc:"https://api.perudevs.com/api/v1/ruc?document=DOCUMENT_NUMBER&key=cGVydWRldnMucHJvZHVjdGlvbi5maXRjb2RlcnMuNjQ1Mjg1ZDA1MzAyNzA0ZDZmMmE1Njg2"},Mt=o=>{const e=o.nombres||o.nombre_comercial,a=o.apellido_paterno||o.razon_social,s=o.apellido_materno||"-",d=o.nombre_completo||o.razon_social;return{nombres:e,apellido_paterno:a,apellido_materno:s,full_name:d}},Ut=async(o,e="dni")=>{try{let a=ie.dni;e!=="dni"&&(a=ie.ruc),a=a.replace("DOCUMENT_NUMBER",o);const{data:s,status:d}=await M.get(a);if(d==200)return Mt(s.resultado)}catch(a){return console.log(a),null}},Et=async o=>{try{const e=U.routes.get().person.create,{data:a}=await M.post(e,o);return O.success("El registro se ha creado correctamente"),a}catch(e){return console.log(e),null}},Rt=[{id:1,name:"DNI"},{id:2,name:"RUC"},{id:3,name:"Pasaporte"},{id:4,name:"Carnet de Extranjería"}],z="blur",At=(o,e,a)=>{e?e.length<8?a(new Error("El numero de documento debe tener al menos 8 digitos")):a():a(new Error("El numero de documento es requerido"))},Ft={tipo_documento:[{required:!0,message:"El tipo de documento es requerido",trigger:z}],numero_documento:[{trigger:z,validator:At}],nombres:[{required:!0,message:"El nombre es requerido",trigger:z}],apellido_paterno:[{required:!0,message:"El apellido paterno es requerido",trigger:z}],apellido_materno:[{required:!0,message:"El apellido materno es requerido",trigger:z}],correo:[{required:!0,message:"Por favor ingrese un correo válido",type:"email",trigger:z}],celular:[{required:!0,message:"El celular es requerido",trigger:z}],sexo:[{required:!0,message:"El sexo es requerido",trigger:z}],fecha_nacimiento:[{required:!0,message:"La fecha de nacimiento es requerida",trigger:z}]},St={class:"flex flex-col gap-3 items-start"},qt=r("i",{class:"fas fa-arrow-left mr-1"},null,-1),Nt=r("span",null,"Volver atrás",-1),jt=r("div",{class:"text-xs text-gray-400 text-center"}," Por favor ingrese valores en los campos (*) para registrar una nueva persona. ",-1),Ot={class:"flex gap-2 items-center"},It={key:1},zt={class:"flex flex-col md:flex-row"},Yt=q({__name:"newPersonForm",emits:["create"],setup(o,{emit:e}){const a=T(),s=T({}),d=T(!1),m=T(null),v=async()=>{a.value.validate(async i=>{if(!i)return;if(m.value.name==="RUC"&&s.value.numero_documento.length!=11)return O.error("El tipo de documento RUC debe tener 11 dígitos");d.value=!0;const _=await Et(s.value);d.value=!1,_&&e("create",_)})};_e(m,()=>{m.value&&(s.value.tipo_documento=m.value.id)});const V=async()=>{var _;if(!s.value.numero_documento&&s.value.numero_documento.length<8||!m.value)return;const i=await Ut(s.value.numero_documento,(_=m.value)==null?void 0:_.name.toLocaleLowerCase());i&&(s.value.apellido_paterno=i.apellido_paterno,s.value.apellido_materno=i.apellido_materno,s.value.nombres=i.nombres,s.value.full_name=i.full_name)},g=()=>{s.value={},a.value.resetFields()};return(i,_)=>{const b=H,E=re,A=le,P=se,p=W,L=we,$=Ve,B=pe,I=ae;return u(),C("div",St,[l(b,{size:"small",link:"",onClick:_[0]||(_[0]=h=>i.$emit("return"))},{default:n(()=>[qt,Nt]),_:1}),jt,l(I,{ref_key:"formPerson",ref:a,class:"w-full bg-gray-100 rounded-lg p-3","label-position":"top",model:t(s),rules:t(Ft)},{default:n(()=>[r("div",Ot,[l(P,{label:"Tipo de Documento",prop:"tipo_documento",class:"w-full"},{default:n(()=>[l(A,{onChange:g,modelValue:t(m),"onUpdate:modelValue":_[1]||(_[1]=h=>Y(m)?m.value=h:null),"value-key":"name",placeholder:"Seleccione un tipo de documento"},{default:n(()=>[(u(!0),C(S,null,j(t(Rt),(h,K)=>(u(),w(E,{key:K,label:h.name,value:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(P,{label:"Numero de documento",prop:"numero_documento",class:"w-full"},{default:n(()=>[l(p,{type:"number",modelValue:t(s).numero_documento,"onUpdate:modelValue":_[2]||(_[2]=h=>t(s).numero_documento=h),onChange:V},null,8,["modelValue"])]),_:1})]),t(m)&&t(m).name==="RUC"?(u(),w(P,{key:0,label:"Nombre Completo",prop:"full_name"},{default:n(()=>[l(p,{modelValue:t(s).full_name,"onUpdate:modelValue":_[3]||(_[3]=h=>t(s).full_name=h),autocomplete:"off"},null,8,["modelValue"])]),_:1})):(u(),C("div",It,[l(P,{label:"Nombres",prop:"nombres"},{default:n(()=>[l(p,{modelValue:t(s).nombres,"onUpdate:modelValue":_[4]||(_[4]=h=>t(s).nombres=h),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(P,{label:"Apellido Paterno",prop:"apellido_paterno"},{default:n(()=>[l(p,{modelValue:t(s).apellido_paterno,"onUpdate:modelValue":_[5]||(_[5]=h=>t(s).apellido_paterno=h),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(P,{label:"Apellido Materno",prop:"apellido_materno"},{default:n(()=>[l(p,{modelValue:t(s).apellido_materno,"onUpdate:modelValue":_[6]||(_[6]=h=>t(s).apellido_materno=h),autocomplete:"off"},null,8,["modelValue"])]),_:1})])),l(P,{label:"Correo Electrónico",prop:"correo"},{default:n(()=>[l(p,{type:"email",modelValue:t(s).correo,"onUpdate:modelValue":_[7]||(_[7]=h=>t(s).correo=h),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(P,{label:"Celular",prop:"celular",class:"w-1/2"},{default:n(()=>[l(p,{type:"mobile",modelValue:t(s).celular,"onUpdate:modelValue":_[8]||(_[8]=h=>t(s).celular=h),autocomplete:"off"},null,8,["modelValue"])]),_:1}),r("div",zt,[l(P,{label:"Sexo",prop:"sexo",class:"w-full"},{default:n(()=>[l($,{modelValue:t(s).sexo,"onUpdate:modelValue":_[9]||(_[9]=h=>t(s).sexo=h)},{default:n(()=>[l(L,{label:"M"},{default:n(()=>[y("Masculino")]),_:1}),l(L,{label:"F"},{default:n(()=>[y("Femenino")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(P,{label:"Fecha de nacimiento",prop:"fecha_nacimiento",class:"w-full"},{default:n(()=>[l(B,{modelValue:t(s).fecha_nacimiento,"onUpdate:modelValue":_[10]||(_[10]=h=>t(s).fecha_nacimiento=h),type:"date",placeholder:"año-mes-dia","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),l(P,null,{default:n(()=>[l(b,{onClick:_[11]||(_[11]=h=>i.$emit("return"))},{default:n(()=>[y("Cancelar")]),_:1}),l(b,{loading:t(d),onClick:v,type:"primary"},{default:n(()=>[y("Crear registro")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}}),Bt=async o=>{try{const{get_person_list:e}=U.routes.get().person,{data:a,status:s}=await M.post(e,{query:o});s==200&&c.personList.set(a)}catch(e){console.log(e)}},Gt=async()=>{try{const{procedure_type:o}=U.routes.get().desk,{data:e,status:a}=await M.get(o.get);a==200&&c.procedureTypeList.set(e)}catch(o){console.log(o)}},Zt=async o=>{var e;try{const a=(e=U.routes.get().desk.procedures)==null?void 0:e.save_procedure;if(!a)return;const{data:s,status:d}=await M.post(a,o);d==200&&(O.success(`Se creo el Documento con código:  ${s.code_number}`),X())}catch(a){console.log(a)}},Ht=async o=>{try{const{get_procedures_requirements:e}=U.routes.get().desk,{data:a,status:s}=await M.post(e,{procedure_type_id:o});s==200&&c.procedureRequirements.set(a)}catch(e){console.log(e)}},te="blur",Kt={person_id:[{required:!0,message:"Por favor seleccione una persona",trigger:te}],procedure_type_id:[{required:!0,message:"Por favor seleccione un tipo de procedimiento",trigger:te}],subject:[{required:!0,message:"Por favor ingrese el asunto",trigger:te},{min:5,message:"El asunto debe tener al menos 5 caracteres",trigger:te}]},Jt=async o=>{var e;try{const a=(e=U.routes.get().desk.procedures)==null?void 0:e.update_procedure;if(!a)return O.error("No se encontró la ruta para actualizar el Documento"),!1;const s=await M.post(a,o);O.success(`Se actualizo el Documento con código:  ${s.data.code_number}`);let d=c.procedureList.get().find(m=>m.id===o.procedure_id);return d&&(d=Object.assign(d,{id:d.id,code_number:d.code_number,reference_doc_number:s.data.reference_doc_number,subject:s.data.subject,solicitante:d.solicitante,created_at:d.created_at,updated_at:d.updated_at})),!0}catch(a){return console.log(a),!1}},Qt={class:"w-full flex items-center justify-between pt-1"},Wt=r("div",null,null,-1),Xt=r("i",{class:"fas fa-plus ml-1 rounded-full"},null,-1),eo=q({__name:"procedureForm",setup(o){const e=T({description:"",reference_doc_number:""}),a=T([]),s=T(!1),d=T(),m=T(),v=R(()=>c.currentProcedure.get()),V=T(!1),g=T(!1),i=T(),_=async()=>{d.value.validate(async L=>{if(!L){O.error("Por favor, rellene los campos correctamente");return}e.value.user_id=Z.user.get().id,V.value=!0,v.value?await Jt({procedure_id:v.value.id,subject:v.value.subject,description:v.value.description,reference_doc_number:v.value.reference_doc_number,number_of_sheets:v.value.number_of_sheets}):await Zt(e.value),c.isModalOpen.set(!1),e.value={},V.value=!1})},b=async L=>{s.value=!0,await Bt(L),s.value=!1,a.value=c.personList.get()},E=()=>{c.isModalOpen.set(!1)},A=()=>{if(!v.value)return;e.value=v.value;const L=c.procedureTypeList.get().find($=>$.id===v.value.procedure_type_id);L&&(e.value.procedure_type_id=L.id)},P=async()=>{e.value.procedure_type_id&&await Ht(e.value.procedure_type_id)},p=async L=>{g.value=!1,await b(L.numero_documento),e.value.person_id=L.id,i.value.focus()};return Q(async()=>{d.value.resetFields(),c.procedureRequirements.set([]),await Gt(),A()}),(L,$)=>{const B=Yt,I=re,h=H,K=le,G=W,D=se,ge=$e,be=ke,ve=ae;return t(g)?(u(),w(B,{key:0,onReturn:$[0]||($[0]=k=>g.value=!1),onCreate:p})):(u(),w(ve,{key:1,class:"w-full bg-gray-100 rounded-lg p-3","label-position":"top",model:t(e),rules:t(Kt),"label-width":"120px",ref_key:"form",ref:d},{default:n(()=>[l(D,{label:"Solicitante",prop:"person_id"},{default:n(()=>[t(v)?(u(),w(G,{key:1,modelValue:t(e).person_full_name,"onUpdate:modelValue":$[2]||($[2]=k=>t(e).person_full_name=k),disabled:""},null,8,["modelValue"])):(u(),w(K,{key:0,ref_key:"personIdRef",ref:m,modelValue:t(e).person_id,"onUpdate:modelValue":$[1]||($[1]=k=>t(e).person_id=k),filterable:"",remote:"","reserve-keyword":"",placeholder:"Ingrese su numero de dni",class:"w-full","remote-method":b,loading:t(s)},{empty:n(()=>[l(I,{value:"",disabled:""},{default:n(()=>[y(" No se encontraron resultados - "),l(h,{link:""},{default:n(()=>[y("crear nuevo registro")]),_:1})]),_:1})]),default:n(()=>[(u(!0),C(S,null,j(t(a),k=>(u(),w(I,{key:k.id,label:k.full_name,value:k.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])),r("div",Qt,[Wt,r("a",{onClick:$[3]||($[3]=k=>g.value=!0),class:"text-xs text-blue-500 cursor-pointer"},[y(" Crear nuevo registro "),Xt])])]),_:1}),l(D,{label:"Tramite",prop:"procedure_type_id"},{default:n(()=>[t(v)?(u(),w(G,{key:1,modelValue:t(e).procedure_type_description,"onUpdate:modelValue":$[5]||($[5]=k=>t(e).procedure_type_description=k),disabled:""},null,8,["modelValue"])):(u(),w(K,{key:0,modelValue:t(e).procedure_type_id,"onUpdate:modelValue":$[4]||($[4]=k=>t(e).procedure_type_id=k),class:"w-full",onChange:P,placeholder:"Seleccione un tramite",ref_key:"procedureTypeIdRef",ref:i},{default:n(()=>[(u(!0),C(S,null,j(t(c).procedureTypeList.get(),k=>(u(),w(I,{value:k.id,label:k.description},null,8,["value","label"]))),256))]),_:1},8,["modelValue"]))]),_:1}),t(c).procedureRequirements.get()&&t(c).procedureRequirements.get().length>0?(u(),w(D,{key:0,label:"Requisitos del tramite"},{default:n(()=>[(u(!0),C(S,null,j(t(c).procedureRequirements.get(),k=>(u(),w(ge,{key:k.id,class:"mx-1",size:"small"},{default:n(()=>[y(x(k.description),1)]),_:2},1024))),128))]),_:1})):F("",!0),l(D,{label:"Asunto",prop:"subject"},{default:n(()=>[l(G,{type:"textarea",modelValue:t(e).subject,"onUpdate:modelValue":$[6]||($[6]=k=>t(e).subject=k)},null,8,["modelValue"])]),_:1}),l(D,{label:"Observación"},{default:n(()=>[l(G,{modelValue:t(e).description,"onUpdate:modelValue":$[7]||($[7]=k=>t(e).description=k),type:"textarea",autosize:{minRows:2,maxRows:4}},null,8,["modelValue"])]),_:1}),l(D,{label:"Referencia"},{default:n(()=>[l(G,{modelValue:t(e).reference_doc_number,"onUpdate:modelValue":$[8]||($[8]=k=>t(e).reference_doc_number=k)},null,8,["modelValue"])]),_:1}),l(D,{label:"Numero de folios"},{default:n(()=>[l(be,{modelValue:t(e).number_of_sheets,"onUpdate:modelValue":$[9]||($[9]=k=>t(e).number_of_sheets=k),min:0,max:100},null,8,["modelValue"])]),_:1}),l(D,{class:"flex items-center mt-10"},{default:n(()=>[l(h,{onClick:E},{default:n(()=>[y("Cancel")]),_:1}),l(h,{loading:t(V),type:"primary",onClick:_},{default:n(()=>[y(x(t(v)?"Actualizar Tramite":"Crear Tramite"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]))}}}),to={class:"my-header text-center mb-6"},oo={class:"my-header text-center mb-6"},so={class:"my-header text-center mb-6"},ao=q({__name:"procedureDrawer",setup(o){const e=R(()=>c.currentProcedure.get()),a=R({get:()=>c.isModalOpen.get(),set:m=>c.isModalOpen.set(m)}),s=R({get:()=>c.isModalDerivation.get(),set:m=>c.isModalDerivation.set(m)}),d=R({get:()=>c.isModalFinish.get(),set:m=>c.isModalFinish.set(m)});return(m,v)=>{const V=eo,g=Ce,i=Lt,_=Tt;return u(),C(S,null,[l(g,{modelValue:t(a),"onUpdate:modelValue":v[0]||(v[0]=b=>Y(a)?a.value=b:null),class:"rounded-lg overflow-hidden customDrawer"},{header:n(()=>[r("div",to,[r("h1",null,x(t(e)?"Actualizar":"Nuevo")+" Tramite",1)])]),default:n(()=>[t(a)?(u(),w(V,{key:0})):F("",!0)]),_:1},8,["modelValue"]),l(g,{modelValue:t(s),"onUpdate:modelValue":v[1]||(v[1]=b=>Y(s)?s.value=b:null),class:"rounded-lg overflow-hidden"},{header:n(()=>[r("div",oo,[r("h1",null,x(t(e)?"Derivar":"")+" Tramite N° "+x(t(e)?t(e).code_number:""),1)])]),default:n(()=>[t(s)?(u(),w(i,{key:0})):F("",!0)]),_:1},8,["modelValue"]),l(g,{modelValue:t(d),"onUpdate:modelValue":v[2]||(v[2]=b=>Y(d)?d.value=b:null),class:"rounded-lg overflow-hidden"},{header:n(()=>[r("div",so,[r("h1",null,x(t(e)?"Finalizar":"")+" Tramite N° "+x(t(e)?t(e).code_number:""),1)])]),default:n(()=>[t(d)?(u(),w(_,{key:0})):F("",!0)]),_:1},8,["modelValue"])],64)}}});const ce=async o=>{var e;try{const a=(e=U.routes.get().desk.procedures)==null?void 0:e.get_procedure_by_id;if(!a){console.log("No se encontró la ruta para obtener el Documento");return}const s=a.replace("procedure_id",o.toString()),d=await M.get(s);c.currentProcedure.set(d.data)}catch(a){console.log(a)}},ro=async o=>{var e;try{const a=(e=U.routes.get().desk.procedures)==null?void 0:e.get_process_tracking_sheet_pdf;if(!a){console.error("route not found");return}const{data:s}=await M.get(a.replace("{procedure_id}",o.toString())),{path:d}=s;window.open(d,"_blank")}catch(a){console.error(a)}},ne=o=>(Le("data-v-2ed411c5"),o=o(),Me(),o),lo={class:"height-adapter overflow-auto"},no={class:"truncate cursor-pointer underline text-blue-500"},co={class:"truncate"},io={class:"truncate font-semibold"},uo=ne(()=>r("i",{class:"fa-solid fa-pen-to-square text-blue-500"},null,-1)),_o=ne(()=>r("i",{class:"fa-sharp fa-solid fa-share-from-square text-blue-500"},null,-1)),po=ne(()=>r("i",{class:"fa-sharp fa-regular fa-circle-xmark text-blue-500"},null,-1)),mo=ne(()=>r("i",{class:"fa-solid fa-download text-blue-500"},null,-1)),fo=q({__name:"tableList",setup(o){const e=R(()=>c.tabSelected.get()),a=R(()=>c.procedureList.get()),s=i=>{c.currentProcedure.set(i),c.isOpenTimeline.set(!0)},d=async i=>{c.currentProcedure.set(i),await ce(i.id),c.isModalOpen.set(!0)},m=(i,_)=>{c.currentProcedure.set(i);const b=_.getColumnIndex();i&&b==0&&s(i)},v=async i=>{c.currentProcedure.set(i),await ce(i.id),c.isModalDerivation.set(!0)},V=async i=>{c.currentProcedure.set(i),await ce(i.id),c.isModalFinish.set(!0)},g=async i=>{c.currentProcedure.set(i),await ro(i.id)};return(i,_)=>{const b=Te,E=De,A=H,P=Pe;return u(),C("div",lo,[l(P,{data:t(a),onRowClick:m},{default:n(()=>[l(E,{prop:"code_number",label:"N° de tramite"},{default:n(({row:p})=>[l(b,{"popper-class":"text-lg",content:`Ver detalles del tramite ${p.code_number}`,placement:"top"},{default:n(()=>[r("div",no,x(p.code_number),1)]),_:2},1032,["content"])]),_:1}),l(E,{prop:"solicitante",label:"Solicitante"}),l(E,{prop:"created_at",label:"Fecha de creación"}),l(E,{prop:"subject",label:"Asunto"},{default:n(({row:p})=>[r("div",co,x(p.subject),1)]),_:1}),l(E,{prop:"last_action",label:"Ultima acción"},{default:n(({row:p})=>[r("div",io,x(p.last_action),1)]),_:1}),l(E,{label:"Acción",class:"w-full bg-red-500"},{default:n(({row:p})=>[t(e)===t(N).started?(u(),w(A,{key:0,size:"small",text:"",onClick:L=>d(p)},{default:n(()=>[l(b,{"popper-class":"text-lg",content:`Editar tramite ${p.code_number}`,placement:"top"},{default:n(()=>[uo]),_:2},1032,["content"])]),_:2},1032,["onClick"])):F("",!0),t(e)!==t(N).finished?(u(),w(A,{key:1,text:"",size:"small",onClick:L=>v(p),disabled:p.state},{default:n(()=>[l(b,{"popper-class":"text-lg",content:p.state?`Tramite ${p.code_number} pendiente de aprobación`:`Derivar tramite ${p.code_number}`,placement:"top"},{default:n(()=>[_o]),_:2},1032,["content"])]),_:2},1032,["onClick","disabled"])):F("",!0),t(e)===t(N).in_progress?(u(),w(A,{key:2,size:"small",text:"",onClick:L=>V(p),disabled:p.state},{default:n(()=>[l(b,{"popper-class":"text-lg",content:p.state?`Tramite ${p.code_number} pendiente de aprobación`:`Finalizar tramite ${p.code_number}`,placement:"top"},{default:n(()=>[po]),_:2},1032,["content"])]),_:2},1032,["onClick","disabled"])):F("",!0),l(A,{id:`loadingButton[${p}]`,size:"small",text:"",onClick:L=>g(p)},{default:n(()=>[l(b,{"popper-class":"text-lg",content:"Descargar PDF del tramite",placement:"top"},{default:n(()=>[mo]),_:1})]),_:2},1032,["id","onClick"])]),_:1})]),_:1},8,["data"])])}}});const go=me(fo,[["__scopeId","data-v-2ed411c5"]]);const bo=o=>{var e;return{tracing_id:o,user_id:(e=Z.user.get())==null?void 0:e.id}},vo=async o=>{var e;try{const a=(e=U.routes.get().desk.procedure_tracing)==null?void 0:e.approve_tracing;if(!a)return;await M.post(a,bo(o)),de(),X(),O.success("Aprobaste la asignación del documento")}catch(a){console.log(a)}},yo={class:"w-full p-2 bg-gray-100 rounded flex flex-col"},xo={class:"flex items-center gap-2"},ho={class:"text-[10px]"},wo={class:"flex"},Vo=r("div",{class:"w-5"},null,-1),$o=q({__name:"pendingCard",props:{cardItem:{type:Object,required:!0}},setup(o){const e=o,a=T(!1),s=R(()=>{const m=e.cardItem.user.split(" ");return`${m[0].charAt(0)}${m[m.length-1].charAt(0)}`}),d=async()=>{a.value=!0,await vo(e.cardItem.id),a.value=!1};return(m,v)=>{const V=Ue,g=H;return u(),C("div",yo,[r("div",xo,[r("div",null,[o.cardItem.image?(u(),w(V,{key:0,size:"small",src:o.cardItem.image},null,8,["src"])):(u(),w(V,{key:1,size:"small"},{default:n(()=>[y(x(t(s)),1)]),_:1}))]),r("div",ho,[r("b",null,x(o.cardItem.user),1),y(" te a asignado un documento el dia "+x(o.cardItem.date)+" a las "+x(o.cardItem.hour),1)])]),r("div",wo,[Vo,r("b",null,[l(g,{onClick:d,loading:t(a),text:"",size:"small",class:"text-blue-500"},{default:n(()=>[y("Aprobar")]),_:1},8,["loading"])])])])}}}),ko={key:0,class:"flex mt-3 bg-yellow-50 p-2 rounded shadow-sm items-center justify-center gap-5 break-normal"},Co=r("i",{class:"fas fa-exclamation-triangle text-2xl text-yellow-500"},null,-1),To=r("div",{class:"flex flex-col gap-2"},[r("h1",{class:"font-semibold"},"¡Estos documentos necesitan de tu atención! 😎"),r("span",{class:"text-xs text-gray-500"}," Aquí se muestran los documentos asignados a ti ó al area donde trabajas, que aún no han sido aprobados o rechazados. ")],-1),Do=[Co,To],Po=r("i",{class:"fas fa-user text-gray-500"},null,-1),Lo={key:0},Mo={key:0,class:"mt-2 w-full cardContent epgScroll"},Uo={class:"flex flex-col"},Eo={class:"flex flex-col mt-5"},Ro=r("i",{class:"fas fa-users text-gray-500"},null,-1),Ao={key:0},Fo={key:0,class:"mt-2 w-full cardContent epgScroll"},So={class:"flex flex-col"},qo=q({__name:"pendingComponent",setup(o){const e=R(()=>oe.tracingsForUser),a=R(()=>oe.tracingsForArea),s=T(!0),d=T(!1);return Q(async()=>{await de(),d.value=!0}),(m,v)=>{const V=$o,g=Ee;return u(),C("div",{class:J(["h-full relative pending",t(s)?"is-open":"is-closed"])},[t(s)?(u(),C("div",ko,Do)):F("",!0),r("div",{class:J(["flex flex-col",t(s)?"mt-4":"mt-10"])},[r("h1",{class:J(["text-xs text-gray-500 flex gap-2 items-center",{"flex flex-col ":!t(s)}])},[Po,t(s)?(u(),C("span",Lo,"Documentos asignados a ti")):F("",!0),r("span",{class:J(["text-xs px-2 bg-yellow-500 text-white rounded-full",{" animate-pulse":!t(s)&&t(e).length>0}])},x(t(e).length),3)],2),t(s)?(u(),C("div",Mo,[r("div",Uo,[(u(!0),C(S,null,j(t(e),(i,_)=>(u(),w(V,{class:"border-b border-white",key:_,"card-item":i},null,8,["card-item"]))),128))])])):F("",!0)],2),l(g),r("div",Eo,[r("h1",{class:J(["text-xs text-gray-500 flex items-center gap-2",{"flex flex-col ":!t(s)}])},[Ro,t(s)?(u(),C("span",Ao,"Documentos asignados a tu área")):F("",!0),r("span",{class:J(["text-xs px-2 bg-yellow-500 text-white rounded-full",{" animate-pulse":!t(s)&&t(e).length>0}])},x(t(a).length),3)],2),t(s)?(u(),C("div",Fo,[r("div",So,[(u(!0),C(S,null,j(t(a),(i,_)=>(u(),w(V,{class:"border-b border-white",key:_,"card-item":i},null,8,["card-item"]))),128))])])):F("",!0)])],2)}}});const No=async()=>{try{const o=U.routes.get().desk.years_for_procedures,{data:e}=await M.get(o);c.yearsProcedures.set(e)}catch(o){console.log(o)}},jo={class:"flex justify-between gap-2 w-full h-full"},Oo={class:"w-max-[350px]"},Io={class:"w-full bg-white shadow-md rounded-lg p-5 flex flex-col gap-5"},zo=r("section",null,[r("p",{class:"text-3xl font-bold"},"Tramites")],-1),Yo={class:"flex flex-col gap-3"},Bo={class:"flex items-center justify-between"},Go={class:"flex items-center gap-2"},Zo={class:"flex"},Ho=r("div",{class:"flex gap-2"},[r("i",{class:"fa-sharp fa-solid fa-search"}),y(" Buscar")],-1),Ko={class:"flex"},Jo=r("div",{class:"flex gap-2"},[r("i",{class:"fa-sharp fa-solid fa-plus"}),y(" Nuevo tramite")],-1),Qo={class:"inline-flex items-center justify-center px-2 py-1 mr-2 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full"},Wo={class:"inline-flex items-center justify-center px-2 py-1 mr-2 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full"},Xo={class:"inline-flex items-center justify-center px-2 py-1 mr-2 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full"},es=q({__name:"index",setup(o){const e=T(N.started),a=T(""),s=T(""),d=T([]),m=T(""),v=()=>{c.currentProcedure.set(null),c.isModalOpen.set(!0)},V=()=>{g()},g=async()=>{let _=`${s.value}-${m.value}`;s.value||(_=null),c.filters.set({date:a.value,code_number:_||"",state:e.value}),c.tabSelected.set(e.value),await X()},i=()=>{g()};return Q(async()=>{No(),d.value=c.yearsProcedures.get(),m.value=new Date().getFullYear().toString(),g()}),(_,b)=>{const E=qo,A=pe,P=re,p=le,L=W,$=H,B=go,I=Fe,h=Ae,K=ao,G=$t;return u(),C(S,null,[r("div",jo,[r("div",Oo,[l(E,{class:"bg-white rounded-lg shadow-md p-5"})]),r("div",Io,[zo,r("div",Yo,[r("div",Bo,[r("div",Go,[l(A,{modelValue:t(a),"onUpdate:modelValue":b[0]||(b[0]=D=>Y(a)?a.value=D:null),type:"date",placeholder:"Selecciona una fecha",onChange:g,format:"DD/MM/YYYY","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),r("div",Zo,[l(p,{modelValue:t(m),"onUpdate:modelValue":b[1]||(b[1]=D=>Y(m)?m.value=D:null),placeholder:"Periodo",onChange:g},{default:n(()=>[(u(!0),C(S,null,j(t(d),D=>(u(),w(P,{key:D,label:D,value:D},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(L,{onInput:i,onKeydown:Re(g,["enter"]),modelValue:t(s),"onUpdate:modelValue":b[2]||(b[2]=D=>Y(s)?s.value=D:null),placeholder:"N° de tramite"},null,8,["onKeydown","modelValue"])]),l($,{type:"primary",onClick:g},{default:n(()=>[Ho]),_:1})]),r("div",Ko,[l($,{type:"primary",onClick:v},{default:n(()=>[Jo]),_:1})])]),l(h,{modelValue:t(e),"onUpdate:modelValue":b[3]||(b[3]=D=>Y(e)?e.value=D:null),onTabChange:V},{default:n(()=>[l(I,{name:t(N).started},{label:n(()=>[r("span",null,[y("Iniciados "),r("div",Qo,x(t(c).procedureCounter.get().started.label),1)])]),default:n(()=>[l(B)]),_:1},8,["name"]),l(I,{name:t(N).in_progress},{label:n(()=>[r("span",null,[y("En proceso "),r("div",Wo,x(t(c).procedureCounter.get().in_progress.label),1)])]),default:n(()=>[l(B)]),_:1},8,["name"]),l(I,{name:t(N).finished},{label:n(()=>[r("span",null,[y("Finalizados "),r("div",Xo,x(t(c).procedureCounter.get().finished.label),1)])]),default:n(()=>[l(B)]),_:1},8,["name"])]),_:1},8,["modelValue"])])])]),l(K),l(G)],64)}}}),ts={};function os(o,e){const a=es;return u(),w(a)}const ns=me(ts,[["render",os]]);export{ns as default};
