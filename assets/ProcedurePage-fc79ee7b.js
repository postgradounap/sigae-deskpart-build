import{r as pe,c as U,d as N,b as u,e as C,g as l,p as w,t as x,h as t,G as R,a as E,u as L,H as de,i as h,w as n,f as a,I as O,J as q,K as Y,L as ye,M as xe,N as he,k as I,m as D,o as J,j as Z,s as Q,v as oe,x as H,y as se,O as re,P as le,Q as me,R as we,S as Ve,C as fe,T as $e,U as ke,V as Ce,W as Te,X as De,D as Pe,F as Me,_ as ge,B as Le,Y as K,Z as Ue,n as Ee,$ as Re,a0 as Ae}from"./index-adef01f1.js";/* empty css                     *//* empty css                 *//* empty css                     */var j=(o=>(o.started="started",o.in_progress="in_progress",o.finished="finished",o))(j||{});const f=pe({procedureList:[],isModalOpen:!1,isModalDetails:!1,isModalDerivation:!1,isModalFinish:!1,personList:[],currentProcedure:null,procedureTypeList:[],headquarterList:[],procedureTracingList:[],procedureCounter:{started:{total:0,count:0,label:""},in_progress:{total:0,count:0,label:""},finished:{total:0,count:0,label:""}},yearsProcedures:[],tabSelected:j.started,isOpenTimeline:!1,areaList:[],userAreaList:[],filters:{date:"",code_number:"",state:j.started},procedureRequirements:[]}),Fe={procedureList:{get:()=>f.procedureList,set:o=>f.procedureList=o},isModalOpen:{get:()=>f.isModalOpen,set:o=>f.isModalOpen=o},isModalDetails:{get:()=>f.isModalDetails,set:o=>f.isModalDetails=o},isModalDerivation:{get:()=>f.isModalDerivation,set:o=>f.isModalDerivation=o},isModalFinish:{get:()=>f.isModalFinish,set:o=>f.isModalFinish=o},personList:{get:()=>f.personList,set:o=>f.personList=o,add:o=>f.personList.push(o)},currentProcedure:{get:()=>f.currentProcedure,set:o=>f.currentProcedure=o},procedureTypeList:{get:()=>f.procedureTypeList,set:o=>f.procedureTypeList=o},headquarterList:{get:()=>f.headquarterList,set:o=>f.headquarterList=o},procedureTracingList:{get:()=>f.procedureTracingList,set:o=>f.procedureTracingList=o},procedureCounter:{get:()=>f.procedureCounter,set:o=>f.procedureCounter=o},yearsProcedures:{get:()=>f.yearsProcedures,set:o=>f.yearsProcedures=o},tabSelected:{get:()=>f.tabSelected,set:o=>f.tabSelected=o},isOpenTimeline:{get:()=>f.isOpenTimeline,set:o=>f.isOpenTimeline=o},areaList:{get:()=>f.areaList,set:o=>f.areaList=o},userAreaList:{get:()=>f.userAreaList,set:o=>f.userAreaList=o,clear:()=>f.userAreaList=[]},filters:{get:()=>f.filters,set:o=>{f.filters=o}},procedureRequirements:{get:()=>f.procedureRequirements,set:o=>f.procedureRequirements=o}},d=U(()=>Fe).value,Se={class:"w-full text-sm p-2 flex flex-col items-center justify-center"},qe=l("i",{class:"fas fa-file-alt text-3xl"},null,-1),Ne={class:"text-xs"},je=l("b",null,"Tramite",-1),Oe=l("div",{class:"w-full h-px bg-gray-300"},null,-1),Ie={class:"p-2 flex flex-col gap-2"},ze=l("div",{class:"text-base text-blue-400 font-light"},"Datos del Tramite",-1),Ye={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},Be=l("i",{class:"fas fa-user"},null,-1),Ge={class:"font-semibold"},Ze={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},He=l("i",{class:"fas fa-calendar"},null,-1),Ke={class:"font-semibold"},Je={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},Qe=l("i",{class:"fas fa-map-marker-alt"},null,-1),We={class:"font-semibold"},Xe={key:0,class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},et=l("i",{class:"fa-sharp fa-solid fa-check"},null,-1),tt=l("span",{class:"font-semibold bg-yellow-400 text-white rounded-lg px-2"},"Por confirmar aprobación",-1),ot=l("div",{class:"w-full border border-dotted"},null,-1),st=l("div",{class:"text-base text-blue-400 font-light"},"Datos del Tramitante",-1),rt={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},lt=l("i",{class:"fas fa-user"},null,-1),at={class:"font-semibold"},nt={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},ct=l("i",{class:"fas fa-file"},null,-1),dt={class:"font-semibold"},it={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},ut=l("i",{class:"fas fa-file"},null,-1),_t={class:"font-semibold"},pt={class:"flex items-center text-xs gap-2 bg-gray-50 px-2 py-1"},mt=l("i",{class:"fas fa-file"},null,-1),ft={class:"font-semibold"},gt=N({__name:"leftCard",setup(o){const e=U(()=>d.currentProcedure.get());return(s,r)=>{var c;return u(),C("div",null,[l("div",Se,[qe,l("div",Ne,[je,w(": "),l("span",null,x((c=t(e))==null?void 0:c.code_number),1)])]),Oe,l("div",Ie,[ze,l("div",Ye,[Be,w("Creado por: "),l("span",Ge,x(t(e).user_name),1)]),l("div",Ze,[He,w("Fecha: "),l("span",Ke,x(t(e).created_at),1)]),l("div",Je,[Qe,w("Lugar de creación: "),l("span",We,x(t(e).headquarter_name),1)]),t(e).state?(u(),C("div",Xe,[et,w("Estado: "),tt])):R("",!0),ot,st,l("div",rt,[lt,w("Tramitante: "),l("span",at,x(t(e).person_full_name),1)]),l("div",nt,[ct,w("Nro. Documento: "),l("span",dt,x(t(e).person_document),1)]),l("div",it,[ut,w("Asunto: "),l("span",_t,x(t(e).procedure_type_description),1)]),l("div",pt,[mt,w("Nro. Referencia: "),l("span",ft,x(t(e).reference_doc_number),1)])])])}}}),bt=async o=>{var e;try{const s=(e=E.routes.get().desk.procedures)==null?void 0:e.get_procedure_and_tracing_by_id;if(!s)return;const{data:r}=await L.post(s,{procedure_id:o});d.currentProcedure.set(r.procedure),d.procedureTracingList.set(r.procedure_tracings)}catch(s){console.log(s)}},vt={class:"flex justify-start gap-2 h-full"},yt={class:"items-center rounded-lg shadow-md w-[60%] h-96 p-2 timelineContent"},xt={class:"p-2 shadow rounded text-xs font-[roboto] border flex flex-col gap-2"},ht={class:"break-normal"},wt={class:"text-[10px]"},Vt=N({__name:"procedureTimeline",setup(o){const e=U({get:()=>d.isOpenTimeline.get(),set:r=>d.isOpenTimeline.set(r)});de(()=>e.value,r=>{r&&bt(d.currentProcedure.get().id)});const s=U(()=>d.procedureTracingList.get());return(r,c)=>{const _=gt,V=he,k=ye,g=xe;return u(),h(g,{modelValue:t(e),"onUpdate:modelValue":c[0]||(c[0]=i=>Y(e)?e.value=i:null),"align-center":!0,class:"customDialog"},{default:n(()=>[l("div",vt,[a(_,{class:"w-[40%] flex flex-col gap-2"}),l("div",yt,[a(k,null,{default:n(()=>[(u(!0),C(q,null,O(t(s),i=>(u(),h(V,{key:i.id,timestamp:i.date+" "+i.hour,placement:"top",color:"green"},{default:n(()=>[l("div",xt,[l("span",ht,x(i.action_log),1),l("b",wt,"Por: "+x(i.user),1)])]),_:2},1032,["timestamp"]))),128))]),_:1})])])]),_:1},8,["modelValue"])}}});const be=async()=>{try{const{get_areas:o}=E.routes.get().desk,{data:e,status:s}=await L.get(o);s==200&&d.areaList.set(e)}catch(o){console.log(o)}},$t=()=>d.filters.get(),W=async()=>{var o;try{const e=(o=E.routes.get().desk.procedures)==null?void 0:o.get_procedures;if(!e)return;const{data:s}=await L.get(e,{params:$t()});d.procedureList.set(s.procedures),d.procedureCounter.set(s.counters)}catch(e){console.log(e)}},kt=async o=>{try{const e=E.routes.get().desk.finally_trace_procedure,{status:s}=await L.post(e,o);s==200&&(I.success("Se Finalizo el Tramite correctamente"),W())}catch(e){console.log(e)}},Ct=N({__name:"procedureFinish",setup(o){const e=D(!1),s=U(()=>d.currentProcedure.get()),r=D({action:"",assigned_user_id:0});J(async()=>{await be()});const c=()=>{d.isModalFinish.set(!1)},_=async()=>{var V;e.value=!0,s.value&&(r.value.procedure_id=s.value.id,Z.user.get()&&(r.value.user_id=(V=Z.user.get())==null?void 0:V.id)),e.value=!1,await kt(r.value),c()};return(V,k)=>{const g=Q,i=oe,p=H,b=se;return u(),h(b,{"label-position":"top",model:t(r)},{default:n(()=>[a(i,{label:"Acción"},{default:n(()=>[a(g,{type:"textarea",autosize:{minRows:4,maxRows:6},modelValue:t(r).action,"onUpdate:modelValue":k[0]||(k[0]=P=>t(r).action=P)},null,8,["modelValue"])]),_:1}),a(i,{class:"flex mt-10 items-end"},{default:n(()=>[a(p,{loading:t(e),type:"primary",onClick:_},{default:n(()=>[w(x(t(s)?"Guardar":""),1)]),_:1},8,["loading"]),a(p,{onClick:c},{default:n(()=>[w("Cancel")]),_:1})]),_:1})]),_:1},8,["model"])}}});const Tt=async o=>{try{const{get_user_for_area:e}=E.routes.get().desk,{data:s,status:r}=await L.post(e,{area_id:o});r==200&&d.userAreaList.set(s)}catch(e){console.log(e)}},X=pe({tracingsForArea:[],tracingsForUser:[]}),te={get tracingsForArea(){return X.tracingsForArea},set tracingsForArea(o){X.tracingsForArea=o},get tracingsForUser(){return X.tracingsForUser},set tracingsForUser(o){X.tracingsForUser=o}},ie=async()=>{var o,e;try{const s=(o=E.routes.get().desk.procedure_tracing)==null?void 0:o.get_tracings_to_approved;if(!s){console.log("No se encontró la ruta para obtener los trámites pendientes");return}const r=((e=Z.user.get())==null?void 0:e.id)||0,{data:c}=await L.post(s,{user_id:r});te.tracingsForArea=c.tracings_for_area,te.tracingsForUser=c.tracings_for_user}catch(s){console.log(s)}},Dt=async o=>{try{const e=E.routes.get().desk.save_derive_procedure,{status:s,data:r}=await L.post(e,o);return s==200?(I.success("Se derivo el Tramite correctamente"),W(),ie(),!0):(I.error(`${r.message}`),!1)}catch(e){return console.log(e),!1}},Pt=N({__name:"procedureDerivation",setup(o){const e=D(!1),s=U(()=>d.currentProcedure.get()),r=U(()=>d.isModalDerivation.get()),c=D({action:"",assigned_user_id:0});J(async()=>{var g;c.value.number_of_sheets=(g=s.value)==null?void 0:g.number_of_sheets,await be()});const _=g=>{c.value.assigned_user_id=0,d.userAreaList.clear(),Tt(g)},V=()=>{d.isModalDerivation.set(!1),d.userAreaList.clear()},k=async()=>{var g;e.value=!0,s.value&&(c.value.procedure_id=s.value.id,Z.user.get()&&(c.value.user_id=(g=Z.user.get())==null?void 0:g.id)),e.value=!1,await Dt(c.value),V()};return de(r,g=>{g||V()}),(g,i)=>{const p=re,b=le,P=oe,F=Q,M=me,m=H,v=se;return u(),h(v,{"label-position":"top",model:t(c)},{default:n(()=>[a(P,{label:"Oficina"},{default:n(()=>[a(b,{class:"w-full",placeholder:"Seleccione una oficina",modelValue:t(c).to_area_id,"onUpdate:modelValue":i[0]||(i[0]=T=>t(c).to_area_id=T),onChange:i[1]||(i[1]=T=>_(t(c).to_area_id))},{default:n(()=>[(u(!0),C(q,null,O(t(d).areaList.get(),T=>(u(),h(p,{key:T.id,label:T.nombre,value:T.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(P,{label:"Acción"},{default:n(()=>[a(F,{type:"textarea",autosize:{minRows:4,maxRows:6},modelValue:t(c).action,"onUpdate:modelValue":i[2]||(i[2]=T=>t(c).action=T)},null,8,["modelValue"])]),_:1}),a(P,{label:"Número de folios"},{default:n(()=>[a(M,{modelValue:t(c).number_of_sheets,"onUpdate:modelValue":i[3]||(i[3]=T=>t(c).number_of_sheets=T),min:0,max:100},null,8,["modelValue"])]),_:1}),a(P,{label:"Asignar Usuario"},{default:n(()=>[a(b,{class:"w-full",placeholder:"Seleccione Usuario",modelValue:t(c).assigned_user_id,"onUpdate:modelValue":i[4]||(i[4]=T=>t(c).assigned_user_id=T)},{default:n(()=>[(u(!0),C(q,null,O(t(d).userAreaList.get(),T=>(u(),h(p,{key:T.id,label:T.full_name,value:T.user_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(P,{class:"flex mt-10 items-end"},{default:n(()=>[a(m,{loading:t(e),type:"primary",onClick:k},{default:n(()=>[w(x(t(s)?"Derivar":""),1)]),_:1},8,["loading"]),a(m,{onClick:V},{default:n(()=>[w("Cancel")]),_:1})]),_:1})]),_:1},8,["model"])}}});const _e={dni:"https://api.perudevs.com/api/v1/dni/simple?document=DOCUMENT_NUMBER&key=cGVydWRldnMucHJvZHVjdGlvbi5maXRjb2RlcnMuNjQ1Mjg1ZDA1MzAyNzA0ZDZmMmE1Njg2",ruc:"https://api.perudevs.com/api/v1/ruc?document=DOCUMENT_NUMBER&key=cGVydWRldnMucHJvZHVjdGlvbi5maXRjb2RlcnMuNjQ1Mjg1ZDA1MzAyNzA0ZDZmMmE1Njg2"},Mt=o=>{const e=o.nombres||o.nombre_comercial,s=o.apellido_paterno||o.razon_social,r=o.apellido_materno||"-",c=o.nombre_completo||o.razon_social;return{nombres:e,apellido_paterno:s,apellido_materno:r,full_name:c}},Lt=async(o,e="dni")=>{try{let s=_e.dni;e!=="dni"&&(s=_e.ruc),s=s.replace("DOCUMENT_NUMBER",o);const{data:r,status:c}=await L.get(s);if(c==200)return Mt(r.resultado)}catch(s){return console.log(s),null}},Ut=async o=>{try{const e=E.routes.get().person.create,{data:s}=await L.post(e,o);return I.success("El registro se ha creado correctamente"),s}catch(e){return console.log(e),null}},Et=[{id:1,name:"DNI"},{id:2,name:"RUC"},{id:3,name:"Pasaporte"},{id:4,name:"Carnet de Extranjería"}],z="blur",Rt=(o,e,s)=>{e?e.length<8?s(new Error("El numero de documento debe tener al menos 8 digitos")):s():s(new Error("El numero de documento es requerido"))},At={tipo_documento:[{required:!0,message:"El tipo de documento es requerido",trigger:z}],numero_documento:[{trigger:z,validator:Rt}],nombres:[{required:!0,message:"El nombre es requerido",trigger:z}],apellido_paterno:[{required:!0,message:"El apellido paterno es requerido",trigger:z}],apellido_materno:[{required:!0,message:"El apellido materno es requerido",trigger:z}],correo:[{required:!0,message:"Por favor ingrese un correo válido",type:"email",trigger:z}],celular:[{required:!0,message:"El celular es requerido",trigger:z}],sexo:[{required:!0,message:"El sexo es requerido",trigger:z}],fecha_nacimiento:[{required:!0,message:"La fecha de nacimiento es requerida",trigger:z}]},Ft={class:"flex flex-col gap-3 items-start"},St=l("i",{class:"fas fa-arrow-left mr-1"},null,-1),qt=l("span",null,"Volver atrás",-1),Nt=l("div",{class:"text-xs text-gray-400 text-center"}," Por favor ingrese valores en los campos (*) para registrar una nueva persona. ",-1),jt={class:"flex gap-2 items-center"},Ot={key:1},It={class:"flex flex-col md:flex-row"},zt=N({__name:"newPersonForm",emits:["create"],setup(o,{emit:e}){const s=D(),r=D({}),c=D(!1),_=D(null),V=async()=>{s.value.validate(async i=>{if(!i)return;if(_.value.name==="RUC"&&r.value.numero_documento.length!=11)return I.error("El tipo de documento RUC debe tener 11 dígitos");c.value=!0;const p=await Ut(r.value);c.value=!1,p&&e("create",p)})};de(_,()=>{_.value&&(r.value.tipo_documento=_.value.id)});const k=async()=>{var p;if(!r.value.numero_documento&&r.value.numero_documento.length<8||!_.value)return;const i=await Lt(r.value.numero_documento,(p=_.value)==null?void 0:p.name.toLocaleLowerCase());i&&(r.value.apellido_paterno=i.apellido_paterno,r.value.apellido_materno=i.apellido_materno,r.value.nombres=i.nombres,r.value.full_name=i.full_name)},g=()=>{r.value={},s.value.resetFields()};return(i,p)=>{const b=H,P=re,F=le,M=oe,m=Q,v=we,T=Ve,B=fe,G=se;return u(),C("div",Ft,[a(b,{size:"small",link:"",onClick:p[0]||(p[0]=y=>i.$emit("return"))},{default:n(()=>[St,qt]),_:1}),Nt,a(G,{ref_key:"formPerson",ref:s,class:"w-full bg-gray-100 rounded-lg p-3","label-position":"top",model:t(r),rules:t(At)},{default:n(()=>[l("div",jt,[a(M,{label:"Tipo de Documento",prop:"tipo_documento",class:"w-full"},{default:n(()=>[a(F,{onChange:g,modelValue:t(_),"onUpdate:modelValue":p[1]||(p[1]=y=>Y(_)?_.value=y:null),"value-key":"name",placeholder:"Seleccione un tipo de documento"},{default:n(()=>[(u(!0),C(q,null,O(t(Et),(y,S)=>(u(),h(P,{key:S,label:y.name,value:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(M,{label:"Número de documento",prop:"numero_documento",class:"w-full"},{default:n(()=>[a(m,{type:"number",modelValue:t(r).numero_documento,"onUpdate:modelValue":p[2]||(p[2]=y=>t(r).numero_documento=y),onChange:k},null,8,["modelValue"])]),_:1})]),t(_)&&t(_).name==="RUC"?(u(),h(M,{key:0,label:"Nombre Completo",prop:"full_name"},{default:n(()=>[a(m,{modelValue:t(r).full_name,"onUpdate:modelValue":p[3]||(p[3]=y=>t(r).full_name=y),autocomplete:"off"},null,8,["modelValue"])]),_:1})):(u(),C("div",Ot,[a(M,{label:"Nombres",prop:"nombres"},{default:n(()=>[a(m,{modelValue:t(r).nombres,"onUpdate:modelValue":p[4]||(p[4]=y=>t(r).nombres=y),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(M,{label:"Apellido Paterno",prop:"apellido_paterno"},{default:n(()=>[a(m,{modelValue:t(r).apellido_paterno,"onUpdate:modelValue":p[5]||(p[5]=y=>t(r).apellido_paterno=y),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(M,{label:"Apellido Materno",prop:"apellido_materno"},{default:n(()=>[a(m,{modelValue:t(r).apellido_materno,"onUpdate:modelValue":p[6]||(p[6]=y=>t(r).apellido_materno=y),autocomplete:"off"},null,8,["modelValue"])]),_:1})])),a(M,{label:"Correo Electrónico",prop:"correo"},{default:n(()=>[a(m,{type:"email",modelValue:t(r).correo,"onUpdate:modelValue":p[7]||(p[7]=y=>t(r).correo=y),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(M,{label:"Celular",prop:"celular",class:"w-1/2"},{default:n(()=>[a(m,{type:"mobile",modelValue:t(r).celular,"onUpdate:modelValue":p[8]||(p[8]=y=>t(r).celular=y),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l("div",It,[a(M,{label:"Sexo",prop:"sexo",class:"w-full"},{default:n(()=>[a(T,{modelValue:t(r).sexo,"onUpdate:modelValue":p[9]||(p[9]=y=>t(r).sexo=y)},{default:n(()=>[a(v,{label:"M"},{default:n(()=>[w("Masculino")]),_:1}),a(v,{label:"F"},{default:n(()=>[w("Femenino")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(M,{label:"Fecha de nacimiento",prop:"fecha_nacimiento",class:"w-full"},{default:n(()=>[a(B,{modelValue:t(r).fecha_nacimiento,"onUpdate:modelValue":p[10]||(p[10]=y=>t(r).fecha_nacimiento=y),type:"date",placeholder:"dia-mes-año",format:"DD-MM-YYYY","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),a(M,null,{default:n(()=>[a(b,{onClick:p[11]||(p[11]=y=>i.$emit("return"))},{default:n(()=>[w("Cancelar")]),_:1}),a(b,{loading:t(c),onClick:V,type:"primary"},{default:n(()=>[w("Crear registro")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])])}}}),Yt=async o=>{try{const{get_person_list:e}=E.routes.get().person,{data:s,status:r}=await L.post(e,{query:o});r==200&&d.personList.set(s)}catch(e){console.log(e)}},Bt=async()=>{try{const{procedure_type:o}=E.routes.get().desk,{data:e,status:s}=await L.get(o.get);s==200&&d.procedureTypeList.set(e)}catch(o){console.log(o)}},Gt=async o=>{var e;try{const s=(e=E.routes.get().desk.procedures)==null?void 0:e.save_procedure;if(!s)return;const{data:r,status:c}=await L.post(s,o);c==200&&(I.success(`Se creo el Documento con código:  ${r.code_number}`),W())}catch(s){console.log(s)}},Zt=async o=>{try{const{get_procedures_requirements:e}=E.routes.get().desk,{data:s,status:r}=await L.post(e,{procedure_type_id:o});r==200&&d.procedureRequirements.set(s)}catch(e){console.log(e)}},ee="blur",Ht={person_id:[{required:!0,message:"Por favor seleccione una persona",trigger:ee}],procedure_type_id:[{required:!0,message:"Por favor seleccione un tipo de procedimiento",trigger:ee}],subject:[{required:!0,message:"Por favor ingrese el asunto",trigger:ee},{min:5,message:"El asunto debe tener al menos 5 caracteres",trigger:ee}]},Kt=async o=>{var e;try{const s=(e=E.routes.get().desk.procedures)==null?void 0:e.update_procedure;if(!s)return I.error("No se encontró la ruta para actualizar el Documento"),!1;const r=await L.post(s,o);I.success(`Se actualizo el Documento con código:  ${r.data.code_number}`);let c=d.procedureList.get().find(_=>_.id===o.procedure_id);return c&&(c=Object.assign(c,{id:c.id,code_number:c.code_number,reference_doc_number:r.data.reference_doc_number,subject:r.data.subject,solicitante:c.solicitante,created_at:c.created_at,updated_at:c.updated_at})),!0}catch(s){return console.log(s),!1}},Jt={key:2,class:"w-full flex items-center justify-between pt-1"},Qt=l("div",null,null,-1),Wt=l("i",{class:"fas fa-plus ml-1 rounded-full"},null,-1),Xt=N({__name:"procedureForm",setup(o){const e=D({description:"",reference_doc_number:""}),s=D([]),r=D(),c=D(),_=U(()=>d.currentProcedure.get()),V=D(!1),k=D(!1),g=D(),i=async()=>{r.value.validate(async m=>{if(!m){I.error("Por favor, rellene los campos correctamente");return}e.value.user_id=Z.user.get().id,V.value=!0,_.value?await Kt({procedure_id:_.value.id,subject:_.value.subject,description:_.value.description,reference_doc_number:_.value.reference_doc_number,number_of_sheets:_.value.number_of_sheets}):await Gt(e.value),d.isModalOpen.set(!1),e.value={},V.value=!1})},p=async m=>{await Yt(m),s.value=d.personList.get()},b=()=>{d.isModalOpen.set(!1)},P=()=>{if(!_.value)return;e.value=_.value;const m=d.procedureTypeList.get().find(v=>v.id===_.value.procedure_type_id);m&&(e.value.procedure_type_id=m.id)},F=async()=>{e.value.procedure_type_id&&await Zt(e.value.procedure_type_id)},M=async m=>{k.value=!1,await p(m.numero_documento),e.value.person_id=m.id,g.value.focus()};return J(async()=>{r.value.resetFields(),d.procedureRequirements.set([]),await Bt(),P()}),(m,v)=>{const T=zt,B=re,G=le,y=Q,S=oe,ne=$e,A=me,ue=H,ve=se;return t(k)?(u(),h(T,{key:0,onReturn:v[0]||(v[0]=$=>k.value=!1),onCreate:M})):(u(),h(ve,{key:1,class:"w-full bg-gray-100 rounded-lg p-3","label-position":"top",model:t(e),rules:t(Ht),"label-width":"120px",ref_key:"form",ref:r},{default:n(()=>[a(S,{label:"Solicitante",prop:"person_id"},{default:n(()=>[t(_)?(u(),h(y,{key:1,modelValue:t(e).person_full_name,"onUpdate:modelValue":v[2]||(v[2]=$=>t(e).person_full_name=$),disabled:""},null,8,["modelValue"])):(u(),h(G,{key:0,ref_key:"personIdRef",ref:c,modelValue:t(e).person_id,"onUpdate:modelValue":v[1]||(v[1]=$=>t(e).person_id=$),filterable:"",remote:"","reserve-keyword":"",placeholder:"Ingrese su numero de dni",class:"w-full","remote-method":p},{default:n(()=>[(u(!0),C(q,null,O(t(s),$=>(u(),h(B,{key:$.id,label:$.full_name,value:$.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])),t(_)?R("",!0):(u(),C("div",Jt,[Qt,l("a",{onClick:v[3]||(v[3]=$=>k.value=!0),class:"text-xs text-blue-500 cursor-pointer"},[w(" Crear nuevo registro "),Wt])]))]),_:1}),a(S,{label:"Tramite",prop:"procedure_type_id"},{default:n(()=>[t(_)?(u(),h(y,{key:1,modelValue:t(e).procedure_type_description,"onUpdate:modelValue":v[5]||(v[5]=$=>t(e).procedure_type_description=$),disabled:""},null,8,["modelValue"])):(u(),h(G,{key:0,modelValue:t(e).procedure_type_id,"onUpdate:modelValue":v[4]||(v[4]=$=>t(e).procedure_type_id=$),class:"w-full",onChange:F,placeholder:"Seleccione un tramite",ref_key:"procedureTypeIdRef",ref:g},{default:n(()=>[(u(!0),C(q,null,O(t(d).procedureTypeList.get(),$=>(u(),h(B,{value:$.id,label:$.description},null,8,["value","label"]))),256))]),_:1},8,["modelValue"]))]),_:1}),t(d).procedureRequirements.get()&&t(d).procedureRequirements.get().length>0?(u(),h(S,{key:0,label:"Requisitos del tramite"},{default:n(()=>[(u(!0),C(q,null,O(t(d).procedureRequirements.get(),$=>(u(),h(ne,{key:$.id,class:"mx-1",size:"small"},{default:n(()=>[w(x($.description),1)]),_:2},1024))),128))]),_:1})):R("",!0),a(S,{label:"Asunto",prop:"subject"},{default:n(()=>[a(y,{type:"textarea",modelValue:t(e).subject,"onUpdate:modelValue":v[6]||(v[6]=$=>t(e).subject=$)},null,8,["modelValue"])]),_:1}),a(S,{label:"Observación"},{default:n(()=>[a(y,{modelValue:t(e).description,"onUpdate:modelValue":v[7]||(v[7]=$=>t(e).description=$),type:"textarea",autosize:{minRows:2,maxRows:4}},null,8,["modelValue"])]),_:1}),a(S,{label:"Referencia"},{default:n(()=>[a(y,{modelValue:t(e).reference_doc_number,"onUpdate:modelValue":v[8]||(v[8]=$=>t(e).reference_doc_number=$)},null,8,["modelValue"])]),_:1}),a(S,{label:"Número de folios"},{default:n(()=>[a(A,{modelValue:t(e).number_of_sheets,"onUpdate:modelValue":v[9]||(v[9]=$=>t(e).number_of_sheets=$),min:0,max:100},null,8,["modelValue"])]),_:1}),a(S,{class:"flex items-center mt-10"},{default:n(()=>[a(ue,{onClick:b},{default:n(()=>[w("Cancel")]),_:1}),a(ue,{loading:t(V),type:"primary",onClick:i},{default:n(()=>[w(x(t(_)?"Actualizar Tramite":"Crear Tramite"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"]))}}}),eo={class:"my-header text-center mb-6"},to={class:"my-header text-center mb-6"},oo={class:"my-header text-center mb-6"},so=N({__name:"procedureDrawer",setup(o){const e=U(()=>d.currentProcedure.get()),s=U({get:()=>d.isModalOpen.get(),set:_=>d.isModalOpen.set(_)}),r=U({get:()=>d.isModalDerivation.get(),set:_=>d.isModalDerivation.set(_)}),c=U({get:()=>d.isModalFinish.get(),set:_=>d.isModalFinish.set(_)});return(_,V)=>{const k=Xt,g=ke,i=Pt,p=Ct;return u(),C(q,null,[a(g,{modelValue:t(s),"onUpdate:modelValue":V[0]||(V[0]=b=>Y(s)?s.value=b:null),class:"rounded-lg overflow-hidden customDrawer"},{header:n(()=>[l("div",eo,[l("h1",null,x(t(e)?"Actualizar":"Nuevo")+" Tramite",1)])]),default:n(()=>[t(s)?(u(),h(k,{key:0})):R("",!0)]),_:1},8,["modelValue"]),a(g,{modelValue:t(r),"onUpdate:modelValue":V[1]||(V[1]=b=>Y(r)?r.value=b:null),class:"rounded-lg overflow-hidden"},{header:n(()=>[l("div",to,[l("h1",null,x(t(e)?"Derivar":"")+" Tramite N° "+x(t(e)?t(e).code_number:""),1)])]),default:n(()=>[t(r)?(u(),h(i,{key:0})):R("",!0)]),_:1},8,["modelValue"]),a(g,{modelValue:t(c),"onUpdate:modelValue":V[2]||(V[2]=b=>Y(c)?c.value=b:null),class:"rounded-lg overflow-hidden"},{header:n(()=>[l("div",oo,[l("h1",null,x(t(e)?"Finalizar":"")+" Tramite N° "+x(t(e)?t(e).code_number:""),1)])]),default:n(()=>[t(c)?(u(),h(p,{key:0})):R("",!0)]),_:1},8,["modelValue"])],64)}}});const ce=async o=>{var e;try{const s=(e=E.routes.get().desk.procedures)==null?void 0:e.get_procedure_by_id;if(!s){console.log("No se encontró la ruta para obtener el Documento");return}const r=s.replace("procedure_id",o.toString()),c=await L.get(r);d.currentProcedure.set(c.data)}catch(s){console.log(s)}},ro=async o=>{var e;try{const s=(e=E.routes.get().desk.procedures)==null?void 0:e.get_process_tracking_sheet_pdf;if(!s){console.error("route not found");return}const{data:r}=await L.get(s.replace("{procedure_id}",o.toString())),{path:c}=r;window.open(c,"_blank")}catch(s){console.error(s)}},ae=o=>(Pe("data-v-2ed411c5"),o=o(),Me(),o),lo={class:"height-adapter overflow-auto"},ao={class:"truncate cursor-pointer underline text-blue-500"},no={class:"truncate"},co={class:"truncate font-semibold"},io=ae(()=>l("i",{class:"fa-solid fa-pen-to-square text-blue-500"},null,-1)),uo=ae(()=>l("i",{class:"fa-sharp fa-solid fa-share-from-square text-blue-500"},null,-1)),_o=ae(()=>l("i",{class:"fa-sharp fa-regular fa-circle-xmark text-blue-500"},null,-1)),po=ae(()=>l("i",{class:"fa-solid fa-download text-blue-500"},null,-1)),mo=N({__name:"tableList",setup(o){const e=U(()=>d.tabSelected.get()),s=U(()=>d.procedureList.get()),r=i=>{d.currentProcedure.set(i),d.isOpenTimeline.set(!0)},c=async i=>{d.currentProcedure.set(i),await ce(i.id),d.isModalOpen.set(!0)},_=(i,p)=>{d.currentProcedure.set(i);const b=p.getColumnIndex();i&&b==0&&r(i)},V=async i=>{d.currentProcedure.set(i),await ce(i.id),d.isModalDerivation.set(!0)},k=async i=>{d.currentProcedure.set(i),await ce(i.id),d.isModalFinish.set(!0)},g=async i=>{d.currentProcedure.set(i),await ro(i.id)};return(i,p)=>{const b=Ce,P=Te,F=H,M=De;return u(),C("div",lo,[a(M,{data:t(s),onRowClick:_},{default:n(()=>[a(P,{prop:"code_number",label:"N° de tramite"},{default:n(({row:m})=>[a(b,{"popper-class":"text-lg",content:`Ver detalles del tramite ${m.code_number}`,placement:"top"},{default:n(()=>[l("div",ao,x(m.code_number),1)]),_:2},1032,["content"])]),_:1}),a(P,{prop:"solicitante",label:"Solicitante"}),a(P,{prop:"created_at",label:"Fecha de creación"}),a(P,{prop:"subject",label:"Asunto"},{default:n(({row:m})=>[l("div",no,x(m.subject),1)]),_:1}),a(P,{prop:"last_action",label:"Ultima acción"},{default:n(({row:m})=>[l("div",co,x(m.last_action),1)]),_:1}),a(P,{label:"Acción",class:"w-full bg-red-500"},{default:n(({row:m})=>[t(e)===t(j).started?(u(),h(F,{key:0,size:"small",text:"",onClick:v=>c(m)},{default:n(()=>[a(b,{"popper-class":"text-lg",content:`Editar tramite ${m.code_number}`,placement:"top"},{default:n(()=>[io]),_:2},1032,["content"])]),_:2},1032,["onClick"])):R("",!0),t(e)!==t(j).finished?(u(),h(F,{key:1,text:"",size:"small",onClick:v=>V(m),disabled:m.state},{default:n(()=>[a(b,{"popper-class":"text-lg",content:m.state?`Tramite ${m.code_number} pendiente de aprobación`:`Derivar tramite ${m.code_number}`,placement:"top"},{default:n(()=>[uo]),_:2},1032,["content"])]),_:2},1032,["onClick","disabled"])):R("",!0),t(e)===t(j).in_progress?(u(),h(F,{key:2,size:"small",text:"",onClick:v=>k(m),disabled:m.state},{default:n(()=>[a(b,{"popper-class":"text-lg",content:m.state?`Tramite ${m.code_number} pendiente de aprobación`:`Finalizar tramite ${m.code_number}`,placement:"top"},{default:n(()=>[_o]),_:2},1032,["content"])]),_:2},1032,["onClick","disabled"])):R("",!0),a(F,{id:`loadingButton[${m}]`,size:"small",text:"",onClick:v=>g(m)},{default:n(()=>[a(b,{"popper-class":"text-lg",content:"Descargar PDF del tramite",placement:"top"},{default:n(()=>[po]),_:1})]),_:2},1032,["id","onClick"])]),_:1})]),_:1},8,["data"])])}}});const fo=ge(mo,[["__scopeId","data-v-2ed411c5"]]);const go=o=>{var e;return{tracing_id:o,user_id:(e=Z.user.get())==null?void 0:e.id}},bo=async o=>{var e;try{const s=(e=E.routes.get().desk.procedure_tracing)==null?void 0:e.approve_tracing;if(!s)return;await L.post(s,go(o)),ie(),W(),I.success("Aprobaste la asignación del documento")}catch(s){console.log(s)}},vo={class:"w-full p-2 bg-gray-100 rounded flex flex-col"},yo={class:"flex items-center gap-2"},xo={class:"text-[10px]"},ho={class:"flex"},wo=l("div",{class:"w-5"},null,-1),Vo=N({__name:"pendingCard",props:{cardItem:{type:Object,required:!0}},setup(o){const e=o,s=D(!1),r=U(()=>{const _=e.cardItem.user.split(" ");return`${_[0].charAt(0)}${_[_.length-1].charAt(0)}`}),c=async()=>{s.value=!0,await bo(e.cardItem.id),s.value=!1};return(_,V)=>{const k=Le,g=H;return u(),C("div",vo,[l("div",yo,[l("div",null,[o.cardItem.image?(u(),h(k,{key:0,size:"small",src:o.cardItem.image},null,8,["src"])):(u(),h(k,{key:1,size:"small"},{default:n(()=>[w(x(t(r)),1)]),_:1}))]),l("div",xo,[l("b",null,x(o.cardItem.user),1),w(" te a asignado un documento el dia "+x(o.cardItem.date)+" a las "+x(o.cardItem.hour),1)])]),l("div",ho,[wo,l("b",null,[a(g,{onClick:c,loading:t(s),text:"",size:"small",class:"text-blue-500"},{default:n(()=>[w("Aprobar")]),_:1},8,["loading"])])])])}}}),$o={key:0,class:"flex mt-3 bg-yellow-50 p-2 rounded shadow-sm items-center justify-center gap-5 break-normal"},ko=l("i",{class:"fas fa-exclamation-triangle text-2xl text-yellow-500"},null,-1),Co=l("div",{class:"flex flex-col gap-2"},[l("h1",{class:"font-semibold"},"¡Estos documentos necesitan de tu atención! 😎"),l("span",{class:"text-xs text-gray-500"}," Aquí se muestran los documentos asignados a ti ó al area donde trabajas, que aún no han sido aprobados. ")],-1),To=[ko,Co],Do=l("i",{class:"fas fa-user text-gray-500"},null,-1),Po={key:0},Mo={key:0,class:"mt-2 w-full cardContent epgScroll"},Lo={class:"flex flex-col"},Uo={class:"flex flex-col mt-5"},Eo=l("i",{class:"fas fa-users text-gray-500"},null,-1),Ro={key:0},Ao={key:0,class:"mt-2 w-full cardContent epgScroll"},Fo={class:"flex flex-col"},So=N({__name:"pendingComponent",setup(o){const e=U(()=>te.tracingsForUser),s=U(()=>te.tracingsForArea),r=D(!0),c=D(!1);return J(async()=>{await ie(),c.value=!0}),(_,V)=>{const k=Vo,g=Ue;return u(),C("div",{class:K(["h-full relative pending",t(r)?"is-open":"is-closed"])},[t(r)?(u(),C("div",$o,To)):R("",!0),l("div",{class:K(["flex flex-col",t(r)?"mt-4":"mt-10"])},[l("h1",{class:K(["text-xs text-gray-500 flex gap-2 items-center",{"flex flex-col ":!t(r)}])},[Do,t(r)?(u(),C("span",Po,"Documentos asignados a ti")):R("",!0),l("span",{class:K(["text-xs px-2 bg-yellow-500 text-white rounded-full",{" animate-pulse":!t(r)&&t(e).length>0}])},x(t(e).length),3)],2),t(r)?(u(),C("div",Mo,[l("div",Lo,[(u(!0),C(q,null,O(t(e),(i,p)=>(u(),h(k,{class:"border-b border-white",key:p,"card-item":i},null,8,["card-item"]))),128))])])):R("",!0)],2),a(g),l("div",Uo,[l("h1",{class:K(["text-xs text-gray-500 flex items-center gap-2",{"flex flex-col ":!t(r)}])},[Eo,t(r)?(u(),C("span",Ro,"Documentos asignados a tu área")):R("",!0),l("span",{class:K(["text-xs px-2 bg-yellow-500 text-white rounded-full",{" animate-pulse":!t(r)&&t(e).length>0}])},x(t(s).length),3)],2),t(r)?(u(),C("div",Ao,[l("div",Fo,[(u(!0),C(q,null,O(t(s),(i,p)=>(u(),h(k,{class:"border-b border-white",key:p,"card-item":i},null,8,["card-item"]))),128))])])):R("",!0)])],2)}}});const qo=async()=>{try{const o=E.routes.get().desk.years_for_procedures,{data:e}=await L.get(o);d.yearsProcedures.set(e)}catch(o){console.log(o)}},No={class:"flex justify-between gap-2 w-full h-full"},jo={class:"w-max-[350px]"},Oo={class:"w-full bg-white shadow-md rounded-lg p-5 flex flex-col gap-5"},Io=l("section",null,[l("p",{class:"text-3xl font-bold"},"Tramites")],-1),zo={class:"flex flex-col gap-3"},Yo={class:"flex items-center justify-between"},Bo={class:"flex items-center gap-2"},Go={class:"flex"},Zo=l("div",{class:"flex gap-2"},[l("i",{class:"fa-sharp fa-solid fa-search"}),w(" Buscar")],-1),Ho={class:"flex"},Ko=l("div",{class:"flex gap-2"},[l("i",{class:"fa-sharp fa-solid fa-plus"}),w(" Nuevo tramite")],-1),Jo={class:"inline-flex items-center justify-center px-2 py-1 mr-2 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full"},Qo={class:"inline-flex items-center justify-center px-2 py-1 mr-2 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full"},Wo={class:"inline-flex items-center justify-center px-2 py-1 mr-2 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full"},Xo=N({__name:"index",setup(o){const e=D(j.started),s=D(""),r=D(""),c=D([]),_=D(""),V=()=>{d.currentProcedure.set(null),d.isModalOpen.set(!0)},k=()=>{g()},g=async()=>{let p=`${r.value}-${_.value}`;r.value||(p=null),d.filters.set({date:s.value,code_number:p||"",state:e.value}),d.tabSelected.set(e.value),await W()},i=()=>{g()};return J(async()=>{qo(),c.value=d.yearsProcedures.get(),_.value=new Date().getFullYear().toString(),g()}),(p,b)=>{const P=So,F=fe,M=re,m=le,v=Q,T=H,B=fo,G=Ae,y=Re,S=so,ne=Vt;return u(),C(q,null,[l("div",No,[l("div",jo,[a(P,{class:"bg-white rounded-lg shadow-md p-5"})]),l("div",Oo,[Io,l("div",zo,[l("div",Yo,[l("div",Bo,[a(F,{modelValue:t(s),"onUpdate:modelValue":b[0]||(b[0]=A=>Y(s)?s.value=A:null),type:"date",placeholder:"Selecciona una fecha",onChange:g,format:"DD/MM/YYYY","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),l("div",Go,[a(m,{modelValue:t(_),"onUpdate:modelValue":b[1]||(b[1]=A=>Y(_)?_.value=A:null),placeholder:"Periodo",onChange:g},{default:n(()=>[(u(!0),C(q,null,O(t(c),A=>(u(),h(M,{key:A,label:A,value:A},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(v,{onInput:i,onKeydown:Ee(g,["enter"]),modelValue:t(r),"onUpdate:modelValue":b[2]||(b[2]=A=>Y(r)?r.value=A:null),placeholder:"N° de tramite"},null,8,["onKeydown","modelValue"])]),a(T,{type:"primary",onClick:g},{default:n(()=>[Zo]),_:1})]),l("div",Ho,[a(T,{type:"primary",onClick:V},{default:n(()=>[Ko]),_:1})])]),a(y,{modelValue:t(e),"onUpdate:modelValue":b[3]||(b[3]=A=>Y(e)?e.value=A:null),onTabChange:k},{default:n(()=>[a(G,{name:t(j).started},{label:n(()=>[l("span",null,[w("Iniciados "),l("div",Jo,x(t(d).procedureCounter.get().started.label),1)])]),default:n(()=>[a(B)]),_:1},8,["name"]),a(G,{name:t(j).in_progress},{label:n(()=>[l("span",null,[w("En proceso "),l("div",Qo,x(t(d).procedureCounter.get().in_progress.label),1)])]),default:n(()=>[a(B)]),_:1},8,["name"]),a(G,{name:t(j).finished},{label:n(()=>[l("span",null,[w("Finalizados "),l("div",Wo,x(t(d).procedureCounter.get().finished.label),1)])]),default:n(()=>[a(B)]),_:1},8,["name"])]),_:1},8,["modelValue"])])])]),a(S),a(ne)],64)}}}),es={};function ts(o,e){const s=Xo;return u(),h(s)}const as=ge(es,[["render",ts]]);export{as as default};
